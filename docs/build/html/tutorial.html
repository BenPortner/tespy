
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TESPy - Thermal Engineering Systems in Python &#8212; tespy 1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to TESPy’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tespy-thermal-engineering-systems-in-python">
<span id="tespy-label"></span><h1>TESPy -  Thermal Engineering Systems in Python<a class="headerlink" href="#tespy-thermal-engineering-systems-in-python" title="Permalink to this headline">¶</a></h1>
<p>TESPy is an oemof-package for the simulation of thermal process plants, such as thermal power plants or heat pumps. The package can be used to calculate stationary plant operation for design and offdesign cases. It is possible to derive plant characteristics which can be used in energy network simulations. In the <span class="xref std std-ref">tespy_examples_label</span> section you can find a short introduction how to use TESPy.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#how-can-i-use-tespy" id="id5">How can I use TESPy?</a><ul>
<li><a class="reference internal" href="#set-up-a-plant" id="id6">Set up a plant</a></li>
<li><a class="reference internal" href="#set-up-the-components" id="id7">Set up the components</a></li>
<li><a class="reference internal" href="#establish-connections" id="id8">Establish connections</a></li>
<li><a class="reference internal" href="#busses-power-connections" id="id9">Busses: power connections</a></li>
<li><a class="reference internal" href="#subsystems" id="id10">Subsystems</a></li>
<li><a class="reference internal" href="#simulate-your-plant" id="id11">Simulate your plant</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tespy-examples" id="id12">TESPy examples</a></li>
</ul>
</div>
<div class="section" id="how-can-i-use-tespy">
<h2><a class="toc-backref" href="#contents">How can I use TESPy?</a><a class="headerlink" href="#how-can-i-use-tespy" title="Permalink to this headline">¶</a></h2>
<p>To use TESPy you have to install TESPy. The installation provides some examples for testing purposes. Once the examples work you are close to your first power plant simulation.</p>
<div class="section" id="set-up-a-plant">
<h3><a class="toc-backref" href="#contents">Set up a plant</a><a class="headerlink" href="#set-up-a-plant" title="Permalink to this headline">¶</a></h3>
<p>In order to simulate a plant you will have to create a tespy.network. The network is the main container for the model.</p>
<p>You need to specify a list of the fluids you need for the calculation in your plant. The whole list of available fluids can be found in the docs. If you want to work with fluid mixtures, for now, it is only possible to use ideal mixtures of real gases. Mixtures of liquids and gases or two liquids are not available. For more information on the fluid properties see the CoolProp documentation on <a class="reference external" href="http://www.coolprop.org/fluid_properties/PurePseudoPure.html">Pure and Pseudo-Pure fluid properties</a>. Further it is possible to choose a unit system for mass flow, temperature and pressure.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tespy</span> <span class="kn">as</span> <span class="nn">pp</span>
<span class="n">my_plant</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">network</span><span class="p">(</span><span class="n">fluids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;air&#39;</span><span class="p">,</span> <span class="s1">&#39;water&#39;</span><span class="p">],</span> <span class="n">T</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now you can start to create the components of the network.</p>
</div>
<div class="section" id="set-up-the-components">
<h3><a class="toc-backref" href="#contents">Set up the components</a><a class="headerlink" href="#set-up-the-components" title="Permalink to this headline">¶</a></h3>
<p>All components can be found in the package components.components. If you set up a component you have to specify a (within one network) unique label. Moreover, it is possible to specify parameters for the component, for example power P for a turbine or upper terminal temperature difference dT_G_u of a heat exchanger. You get a full list of parameters for a specific component (e. g. a vessel) by typing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tespy.components.components</span> <span class="kn">as</span> <span class="nn">comp</span>
<span class="k">print</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">vessel</span><span class="o">.</span><span class="n">variables</span><span class="p">())</span>
</pre></div>
</div>
<p>All parameters besides the label and the fuel for combustion chambers are optional, thus if not set, they will be a result of the plant simulation. In this way, the set of equations a component returns is determined by which parameters you specify. The example below shows how to create a component with specific parameters, set or reset and how to unset a parameter:</p>
<div class="highlight-python" id="pump-parametrisation"><div class="highlight"><pre><span></span><span class="n">my_pump</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">pump</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;pump&#39;</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mf">1e3</span><span class="p">)</span> <span class="c1"># create pump</span>
<span class="n">my_pump</span><span class="o">.</span><span class="n">set_attr</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="mf">2e3</span><span class="p">,</span> <span class="n">eta_s</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span> <span class="c1"># reset power, set isentropic efficiency</span>
<span class="n">my_pump</span><span class="o">.</span><span class="n">set_attr</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="c1"># unset power</span>
</pre></div>
</div>
<p>After setting up the components the next step is to connect the components in our network.</p>
</div>
<div class="section" id="establish-connections">
<h3><a class="toc-backref" href="#contents">Establish connections</a><a class="headerlink" href="#establish-connections" title="Permalink to this headline">¶</a></h3>
<p>Connections are used to link two components (outlet of component 1 to inlet of component 2, source to target). If two components are connected to each other the fluid properties at the source will be equal to the properties at the target. It is possible to set the properties on each connection in a similar way as parameters are set for components. It is possible to specify:</p>
<blockquote>
<div><ul class="simple">
<li>mass flow*,</li>
<li>pressure*,</li>
<li>enthalpy*,</li>
<li>temperature*,</li>
<li>vapour mass fraction for pure fluids and</li>
<li>a fluid vector.</li>
</ul>
</div></blockquote>
<p>All parameters but the fluid vector have to be numeric values. The fluid vector has to be specified as dictonary, see the example below. For the properties marked with * it is possible to use references instead of numeric values. This can be used for example if you want to have the same pressure in two parts of your network but you do not know the pressure prior to the plant simulation.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tespy.connections.connections</span> <span class="kn">as</span> <span class="nn">conn</span>
<span class="kn">import</span> <span class="nn">tespy.connections.references</span> <span class="kn">as</span> <span class="nn">ref</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">conn</span><span class="p">(</span><span class="n">waste_steam_source</span><span class="p">,</span> <span class="s1">&#39;out1&#39;</span><span class="p">,</span> <span class="n">condenser</span><span class="p">,</span> <span class="s1">&#39;in1&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.97</span><span class="p">)</span> <span class="c1"># waste steam source to condenser hot side inlet and setting vapour mass fraction</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">conn</span><span class="p">(</span><span class="n">condenser</span><span class="p">,</span> <span class="s1">&#39;out1&#39;</span><span class="p">,</span> <span class="n">feed_water_pump</span><span class="p">,</span> <span class="s1">&#39;in1&#39;</span><span class="p">,</span> <span class="n">fluid</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;air&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span> <span class="c1"># setting a fluid vector: {&#39;fluid i&#39;: mass fraction i}</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">conn</span><span class="p">(</span><span class="n">feed_water_tank</span><span class="p">,</span> <span class="s1">&#39;out1&#39;</span><span class="p">,</span> <span class="n">feed_water_pump</span><span class="p">,</span> <span class="s1">&#39;in1&#39;</span><span class="p">)</span> <span class="c1"># connection without parameter specification</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">conn</span><span class="p">(</span><span class="n">feed_water_pump</span><span class="p">,</span> <span class="s1">&#39;out1&#39;</span><span class="p">,</span> <span class="n">economiser</span><span class="p">,</span> <span class="s1">&#39;in2&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span> <span class="c1">#  setting pressure</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">conn</span><span class="p">(</span><span class="n">economiser</span><span class="p">,</span> <span class="s1">&#39;out2&#39;</span><span class="p">,</span> <span class="n">drum</span><span class="p">,</span> <span class="s1">&#39;in1&#39;</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">320</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">ref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="c1"># setting temperature and pressure via reference object</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">conn</span><span class="p">(</span><span class="n">evaporator</span><span class="p">,</span> <span class="s1">&#39;out1&#39;</span><span class="p">,</span> <span class="n">economiser</span><span class="p">,</span> <span class="s1">&#39;in1&#39;</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">350</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># setting temperature and mass flow</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">conn</span><span class="p">(</span><span class="n">economiser</span><span class="p">,</span> <span class="s1">&#39;out1&#39;</span><span class="p">,</span> <span class="n">flue_gas_sink</span><span class="p">,</span> <span class="s1">&#39;in1&#39;</span><span class="p">,</span> <span class="n">fluid</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;air&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.013</span><span class="p">)</span> <span class="c1"># setting fluid vector and pressure</span>
</pre></div>
</div>
<p>If you want to set, reset or unset a connection parameter the same logic as for the components is applied.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">set_attr</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span> <span class="c1"># reset vapour mass fraction, set pressure</span>
<span class="n">d</span><span class="o">.</span><span class="n">set_attr</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="c1"># unset pressure</span>
</pre></div>
</div>
</div>
<div class="section" id="busses-power-connections">
<h3><a class="toc-backref" href="#contents">Busses: power connections</a><a class="headerlink" href="#busses-power-connections" title="Permalink to this headline">¶</a></h3>
<p>Busses can be used to add up the power of different turbomachinery or to add up heat flux of different heat exchangers within your network. This can be used either for easy post processing, e. g. to calculate thermal efficiency or you can build up relations between components in your network. If you want to use the busses for postprocessing only, you do not specify the sum of the power or heat flux on your bus. For establishing relations between different components, for instance when using a steam turbine powered feed water pump, you have to set the total power on this bus. In the code example the power of the turbine and the feed water pump is added up and set to zero, as the turbines and feed water pumps power have to be equal in absolute value but have different sign. The sign can be manipulated, e. g. in order to design two turbines with equal power output.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tespy</span> <span class="kn">import</span> <span class="n">connections</span> <span class="k">as</span> <span class="n">con</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bus</span><span class="p">(</span><span class="s1">&#39;feed water pump&#39;</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">add_comp</span><span class="p">([</span><span class="n">turbine_fwp</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">fwp</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">bus</span><span class="p">(</span><span class="s1">&#39;turbines&#39;</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">add_comp</span><span class="p">([</span><span class="n">turbine_hp</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">turbine_lp</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>Two labels for busses have a predefined function in the postprocessing analysis: ‘P’ and ‘Q_diss’. If you specify these labels for your busses, ‘P’ will be interpreted as the total power of your process and ‘Q_diss’ as total amount of dissipated heat flux (from the process, not internally). Given these key figures, thermal efficiency and COP will be calculated and an entropy analysis for your systems components will be performed.</p>
</div>
<div class="section" id="subsystems">
<h3><a class="toc-backref" href="#contents">Subsystems</a><a class="headerlink" href="#subsystems" title="Permalink to this headline">¶</a></h3>
<p>Subsystems are an easy way to add frequently used component groups such as a drum with evaporator or a preheater with desuperheater to your system. You can use the predefined subsystems or create a subsytem yourself from a network object. Every subsystem must have two interfaces, an inlet interface and an outlet interface. These interfaces have a variable number of connections, which can be connected with the rest of your network. The example below uses the predefined subsystem preheater with desuperheater. The subsystems interfaces are subsys.inlet and subsys.outlet, both with two connections. All connections (and components) of the subsystem have to be added to the network in order to start a simulation. This can easily be done by adding the whole subsystem object to your network.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;source1&#39;</span><span class="p">)</span>
<span class="n">sink</span> <span class="o">=</span> <span class="n">sink</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sink1&#39;</span><span class="p">)</span>
<span class="n">source2</span> <span class="o">=</span> <span class="n">source</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;source2&#39;</span><span class="p">)</span>
<span class="n">sink2</span> <span class="o">=</span> <span class="n">sink</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sink2&#39;</span><span class="p">)</span>

<span class="n">subsys</span> <span class="o">=</span> <span class="n">ph_desup</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sub1&#39;</span><span class="p">,</span> <span class="n">dT_G</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">dp1_desup</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dp2_desup</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dp1_cond</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dp2_cond</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">connection</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;out1&#39;</span><span class="p">,</span> <span class="n">subsys</span><span class="o">.</span><span class="n">inlet</span><span class="p">,</span> <span class="s1">&#39;in1&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">29e5</span><span class="p">,</span> <span class="n">fluid</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">connection</span><span class="p">(</span><span class="n">subsys</span><span class="o">.</span><span class="n">outlet</span><span class="p">,</span> <span class="s1">&#39;out1&#39;</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="s1">&#39;in1&#39;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">connection</span><span class="p">(</span><span class="n">source2</span><span class="p">,</span> <span class="s1">&#39;out1&#39;</span><span class="p">,</span><span class="n">subsys</span><span class="o">.</span><span class="n">inlet</span><span class="p">,</span><span class="s1">&#39;in2&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">3e5</span><span class="p">,</span> <span class="n">fluid</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">connection</span><span class="p">(</span><span class="n">subsys</span><span class="o">.</span><span class="n">outlet</span><span class="p">,</span> <span class="s1">&#39;out2&#39;</span><span class="p">,</span> <span class="n">sink2</span><span class="p">,</span> <span class="s1">&#39;in1&#39;</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">nw</span> <span class="o">=</span> <span class="n">network</span><span class="p">(</span><span class="n">fluids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;water&#39;</span><span class="p">],</span> <span class="n">T</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
<span class="n">nw</span><span class="o">.</span><span class="n">add_conn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="n">nw</span><span class="o">.</span><span class="n">add_subsys</span><span class="p">(</span><span class="n">subsys</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="simulate-your-plant">
<h3><a class="toc-backref" href="#contents">Simulate your plant</a><a class="headerlink" href="#simulate-your-plant" title="Permalink to this headline">¶</a></h3>
<p>Before learning how to start the simulation a short introduction on how the solution process works is provdided below.</p>
<div class="section" id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h4>
<p>A tespy.network can be represented as a linear system of non-linear equations, consequently the solution is obtained with numerical methods. TESPy uses the n-dimensional newton algorithm to find the systems solution, which may only be found, if the network is parameterized correctly. The variables of the system are mass flow, pressure, enthalpy and the fluid components on each connection of the network. Thus, the number of fluids you specify in the fluid list for the network and the number of connections determine the number of variables in the system:</p>
<div class="math">
\[num_{var} = num_{conn} \cdot (3 + num_{fluids}).\]</div>
<p>The newton algorithm requires the calculation of residual values for the equations and partial derivatives of all variables (jacobian matrix). In the next step the matrix has to be inverted and multiplied with the residual vector to calculate the increment for the systems variables. This process is repeated until every equations result in the system is correct, thus the residual values are smaller than a specified error tolerance.</p>
<p>jacobian matrix J</p>
<div class="math">
\[\begin{split}J(\vec{x})=\left(\begin{array}{cccc}
\frac{\partial f_1}{\partial x_1} &amp; \frac{\partial f_1}{\partial x_2} &amp; \cdots &amp; \frac{\partial f_1}{\partial x_n} \\
\frac{\partial f_2}{\partial x_1} &amp; \frac{\partial f_2}{\partial x_2} &amp; \cdots &amp; \frac{\partial f_2}{\partial x_n} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\frac{\partial f_n}{\partial x_1} &amp; \frac{\partial f_n}{\partial x_2} &amp; \cdots &amp; \frac{\partial f_n}{\partial x_n}
\end{array}\right)\end{split}\]</div>
<p>calculate increment</p>
<div class="math">
\[\vec{x}_{i+1}=\vec{x}_i-J(\vec{x}_i)^{-1}\cdot f(\vec{x}_i)\]</div>
<p>stop when</p>
<div class="math">
\[||f(\vec{x}_i)|| \leq \epsilon\]</div>
<p>This means that you have to provide the exact amount of required parameters (neither less nor more) and the parametrisation must not lead to linear dependencies. Each parameter you set for a connection or each power respectively heat flux you set for a bus will add one equation. On top, each component provides a different amount of basic equations plus the equations provided by your component specification. For example, setting the power of the pump above results in an additional equation compared to a pump without specified power:</p>
<div class="math">
\[\begin{split}\forall i \in \mathrm{network.fluids} \, &amp;0 = fluid_{i,in} - fluid_{i,out}\\
                                                                                 &amp;0 = \dot{m}_{in} - \dot{m}_{out}\\
                                 \mathrm{additional:} \, &amp;0 = 1000 - \dot{m}_{in} (\cdot {h_{out} - h_{in}})\end{split}\]</div>
</div>
<div class="section" id="initialise-the-calculation">
<h4>Initialise the calculation<a class="headerlink" href="#initialise-the-calculation" title="Permalink to this headline">¶</a></h4>
<p>The newton algorithm requires starting values for all variables of the system. A high quality of initial values (low deveiation from solution) improves convergence speed and stability, whereas bad starting values might lead to instabilty and diverging calculation can be the result. In order to provide good initial values you can choose between three different initialisation options:</p>
<ul class="simple">
<li>initialise with standard values,</li>
<li>provide starting values on your connections (see connection d in the subsystem example, usage: <code class="code docutils literal"><span class="pre">m0,</span> <span class="pre">p0,</span> <span class="pre">h0</span></code>) and</li>
<li>provide a .csv-file of a previously calculated network.</li>
</ul>
<p>The last option usually yields the best performance and is highly receommended. In order to initialise your calculation from a <a href="#id1"><span class="problematic" id="id2">*</span></a>.csv-file, you need to provide the filename <a href="#id3"><span class="problematic" id="id4">*</span></a>. The file does not need to contain all connections of your network, thus you can build up your network bit by bit and initialise the untouched part of your network from the .csv-file.</p>
</div>
<div class="section" id="solve-the-network">
<h4>Solve the network<a class="headerlink" href="#solve-the-network" title="Permalink to this headline">¶</a></h4>
<p>Starting with the subsystem example, in order to start your calculation you need to add the following line to your code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">solve</span><span class="o">.</span><span class="n">loop</span><span class="p">(</span><span class="n">nw</span><span class="p">,</span> <span class="n">init_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">design_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;design&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This starts the initialisation of your network and proceeds to its calculation.</p>
<ul class="simple">
<li><code class="code docutils literal"><span class="pre">nw</span></code> is the network object,</li>
<li><code class="code docutils literal"><span class="pre">init_file</span></code> is the .csv-file you want to use for initialisation,</li>
<li><code class="code docutils literal"><span class="pre">design_file</span></code> is the .csv-file which holds the information of your plants design point and</li>
<li><code class="code docutils literal"><span class="pre">mode</span></code> is the calculation mode (design-calculation or offdesign-calculation).</li>
</ul>
<p>There are two modes available (<code class="code docutils literal"><span class="pre">'design'</span></code> and <code class="code docutils literal"><span class="pre">'offdesign'</span></code>). If you choose <code class="code docutils literal"><span class="pre">offdesign</span></code> as calculation mode a design file must be specified. The initialisation file is always optional, if you specify it to be <code class="code docutils literal"><span class="pre">None</span></code>, the initialisation from .csv-file will be skipped.</p>
</div>
<div class="section" id="postprocessing">
<h4>Postprocessing<a class="headerlink" href="#postprocessing" title="Permalink to this headline">¶</a></h4>
<p>The preprocessing has three functions you can apply to your calculation:</p>
<ul class="simple">
<li>plot the convergence history,</li>
<li>print the results to prompt and</li>
<li>save the results in a .csv-file.</li>
</ul>
<p>The plotting function is designed to use for trouble shooting when your calculation does not converge. Therefore you can specify a maximum number of iterations for the newton algorithm before calculation will be canceled. As a result you get a plot of mass flow, pressure and enthalpy on all connections of your network. From there it might be possible to identify e. g. oscillating values, which might be stabilised with improved initialisation parameters.</p>
</div>
<div class="section" id="offdesign-calculations">
<h4>Offdesign calculations<a class="headerlink" href="#offdesign-calculations" title="Permalink to this headline">¶</a></h4>
<p>After designing your process you might want to gain information on offdesign behaviour. By stating <code class="code docutils literal"><span class="pre">'offdesing'</span></code> as calculation mode, you can switch the component behaviour to offdesign. For example, this means that pressure drop in a pipe will be the result of reynolds number and the pipes dimensions. The table below shows all offdesign parameters available.</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="23%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">component</th>
<th class="head">parameter</th>
<th class="head">affects</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vessel</td>
<td>zeta</td>
<td>pressure drop</td>
</tr>
<tr class="row-odd"><td>pipe</td>
<td><div class="first last line-block">
<div class="line">zeta <sup>1</sup></div>
<div class="line">dimensions <sup>1</sup></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">pressure drop</div>
<div class="line">pressure drop</div>
</div>
</td>
</tr>
<tr class="row-even"><td>simple heat exchanger</td>
<td>zeta</td>
<td>pressure drop</td>
</tr>
<tr class="row-odd"><td>heat exchanger</td>
<td><div class="first last line-block">
<div class="line">zeta1</div>
<div class="line">zeta2</div>
<div class="line">kA</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">pressure drop hot side</div>
<div class="line">pressure drop cold side</div>
<div class="line">heat flux</div>
</div>
</td>
</tr>
<tr class="row-even"><td>pump</td>
<td>characteristic</td>
<td>isentropic efficiency</td>
</tr>
<tr class="row-odd"><td>turbine</td>
<td><div class="first last line-block">
<div class="line">cone law</div>
<div class="line">characteristic</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">pressure drop, volumetric flow</div>
<div class="line">isentropic efficiency</div>
</div>
</td>
</tr>
<tr class="row-even"><td>compressor</td>
<td><div class="first last line-block">
<div class="line">characteristic</div>
<div class="line">vigv angle <sup>2</sup></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">mass flow, pressure rise, isentropic efficiency</div>
<div class="line">see above, one arbitrary parameter less</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>1: If you set both parameters the length or the diameter must be a free parameter.</p>
<p>2: When setting the vigv angle the characteristic map will be used for a specific vigv angle. The vigv angle is a result of the calculation, if you use the characteristic map only</p>
</div>
</div>
</div>
<div class="section" id="tespy-examples">
<h2><a class="toc-backref" href="#contents">TESPy examples</a><a class="headerlink" href="#tespy-examples" title="Permalink to this headline">¶</a></h2>
<p>(<code class="xref download docutils literal"><span class="pre">source</span> <span class="pre">file</span></code>, <code class="xref download docutils literal"><span class="pre">data</span> <span class="pre">file</span></code>)</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">TESPy -  Thermal Engineering Systems in Python</a><ul>
<li><a class="reference internal" href="#how-can-i-use-tespy">How can I use TESPy?</a><ul>
<li><a class="reference internal" href="#set-up-a-plant">Set up a plant</a></li>
<li><a class="reference internal" href="#set-up-the-components">Set up the components</a></li>
<li><a class="reference internal" href="#establish-connections">Establish connections</a></li>
<li><a class="reference internal" href="#busses-power-connections">Busses: power connections</a></li>
<li><a class="reference internal" href="#subsystems">Subsystems</a></li>
<li><a class="reference internal" href="#simulate-your-plant">Simulate your plant</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#initialise-the-calculation">Initialise the calculation</a></li>
<li><a class="reference internal" href="#solve-the-network">Solve the network</a></li>
<li><a class="reference internal" href="#postprocessing">Postprocessing</a></li>
<li><a class="reference internal" href="#offdesign-calculations">Offdesign calculations</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#tespy-examples">TESPy examples</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to TESPy’s documentation!</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Francesco Witte.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/tutorial.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>